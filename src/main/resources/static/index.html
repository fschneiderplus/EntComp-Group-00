<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ollama Roadmap</title>
    <script src="https://cdn.jsdelivr.net/npm/mind-elixir@2.0.0/dist/mind-elixir.js"></script>
    <style>
        #map { width: 100%; height: 80vh; }
    </style>
</head>
<body>
<h1>Generate Roadmap via Ollama</h1>
<input type="text" id="promptInput" placeholder="Enter your prompt">
<button onclick="generateRoadmap()">Generate</button>
<div id="map"></div>

<script>
    function generateRoadmap() {
        const prompt = document.getElementById('promptInput').value;
        fetch('/api/roadmap', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt })
        })
            .then(response => response.json())
            .then(data => {
                // Convert RoadmapNodeDTO to MindElixir format
                const mindData = {
                    nodeData: convertDTOToMindElixir(data, "root"),
                    linkData: {}
                };

                // Render with MindElixir
                const mind = new MindElixir({
                    el: '#map',
                    direction: MindElixir.LEFT,
                    data: mindData,
                    draggable: false
                });
                mind.init();
            })
            .catch(err => console.error(err));
    }

    function convertDTOToMindElixir(nodeDTO, idPrefix) {
        const node = {
            id: idPrefix + Math.random().toString(36).substring(2, 6),
            topic: nodeDTO.title + (nodeDTO.description ? `: ${nodeDTO.description}` : ""),
            expanded: true,
            children: []
        };
        if (nodeDTO.link) node.hyperlink = nodeDTO.link;
        if (nodeDTO.children && nodeDTO.children.length) {
            node.children = nodeDTO.children.map(c => convertDTOToMindElixir(c, idPrefix));
        }
        return node;
    }
</script>
</body>
</html>
<!--asd-->